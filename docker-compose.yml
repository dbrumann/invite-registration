version: '3'

services:
    db:
        image: mysql:latest
        volumes:
            - db_data:/var/lib/mysql
        ports:
            - 3306:3306
        environment:
            MYSQL_ROOT_PASSWORD: rootpass
            MYSQL_DATABASE: invite_registration
            MYSQL_USER: dbuser
            MYSQL_PASSWORD: dbpass

    queue:
        image: rabbitmq:management
        ports:
            - 15672:15672

    app:
        build: ./docker/app
        links:
            - db
            - queue
        volumes:
            - .:/opt/invite-registration:cached
        ports:
            - 8000:8000
        environment:
            APP_ENV: "dev"
            APP_DEBUG: 1
            APP_SECRET: "90bdd6ea7f7117657cbc1e304392971f"
            DATABASE_URL: "mysql://dbuser:dbpass@db:3306/invite_registration"
            MESSENGER_TRANSPORT_DSN: "amqp://guest:guest@queue:5672/%2f"
            MAILER_URL: "null://localhost"

volumes:
    db_data: ~
